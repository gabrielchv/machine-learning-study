<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Task Helper AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Limita a altura do chat considerando o novo padding do header */
        .chat-container { height: calc(100vh - 240px); }
        body { background-color: #1a1a1a; }

        header {
            padding-top: env(safe-area-inset-top, 16px) !important;
            padding-bottom: 16px !important;
        }

        #input {
            font-size: 16px !important;
        }

        /* Spinner de carregamento */
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .send-icon { transform: rotate(90deg); }
    </style>
</head>
<body class="h-screen flex justify-center overflow-hidden">

    <div class="w-full max-w-md bg-gray-100 flex flex-col shadow-2xl relative">
        
        <header class="bg-blue-600 text-white text-center font-bold shadow-md">
            Task Helper AI
        </header>

        <div id="chat" class="chat-container overflow-y-auto p-4 space-y-4 flex flex-col">
            <div class="bg-white p-3 rounded-lg shadow-sm max-w-[85%] text-sm">
                Olá! Me mande uma lista de tarefas e eu as organizarei com o Gemini.
            </div>
        </div>

        <div class="p-4 bg-white border-t" style="padding-bottom: calc(env(safe-area-inset-bottom, 16px) + 16px);">
            <div class="flex gap-2 items-center">
                <input type="text" id="input" 
                    class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                    placeholder="Digite e aperte Enter...">
                
                <button onclick="send()" id="btn" 
                    class="bg-blue-600 text-white p-2.5 rounded-full hover:bg-blue-700 transition-all flex items-center justify-center min-w-[40px] min-h-[40px]">
                    <svg id="send-svg" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 send-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                </button>
            </div>
            
            <div class="mt-4 text-center">
                <a href="https://www.linkedin.com/in/gabriel-chv" target="_blank" 
                   class="text-[10px] text-gray-400 hover:text-blue-500 transition-colors uppercase tracking-widest font-semibold">
                    Desenvolvido por Gabriel Chaves | LinkedIn
                </a>
            </div>
        </div>
    </div>

    <script>
        const FUNCTION_URL = "https://task-helper-662877194200.southamerica-east1.run.app";

        async function send() {
            const input = document.getElementById('input');
            const btn = document.getElementById('btn');
            const chat = document.getElementById('chat');
            const text = input.value.trim();
            
            if(!text || btn.disabled) return;

            btn.disabled = true;
            input.disabled = true;
            btn.innerHTML = '<div class="loader"></div>';

            chat.innerHTML += `<div class="bg-blue-500 text-white p-3 rounded-lg shadow-sm self-end ml-auto max-w-[85%] text-sm">${text}</div>`;
            input.value = "";
            chat.scrollTop = chat.scrollHeight;

            const loadingId = "loading-" + Date.now();
            chat.innerHTML += `<div id="${loadingId}" class="bg-white p-3 rounded-lg shadow-sm max-w-[85%] text-sm text-gray-400 italic flex items-center gap-2">
                <div class="loader" style="width:12px; height:12px; border-width:1px;"></div> Gemini está processando...
            </div>`;
            chat.scrollTop = chat.scrollHeight;

            try {
                const res = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text})
                });
                const data = await res.json();
                document.getElementById(loadingId).remove();

                let reply = "✅ **Tarefas:**<br><div class='mt-2 space-y-2'>";
                data.tasks.forEach(t => {
                    reply += `<div class='border-l-2 border-blue-500 pl-2'>
                                <span class='font-bold block text-gray-800'>${t.title}</span>
                                <span class='text-xs text-gray-500'>${t.description}</span>
                              </div>`;
                });
                reply += "</div>";

                chat.innerHTML += `<div class="bg-white p-3 rounded-lg shadow-sm max-w-[85%] text-sm text-gray-800">${reply}</div>`;
            } catch (e) {
                if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
                chat.innerHTML += `<div class="bg-red-50 p-3 rounded-lg shadow-sm max-w-[85%] text-xs text-red-600 border border-red-100">Erro na conexão.</div>`;
            } finally {
                btn.disabled = false;
                input.disabled = false;
                btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 send-icon" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>`;
                chat.scrollTop = chat.scrollHeight;
            }
        }

        document.getElementById('input').addEventListener('keypress', (e) => { if (e.key === 'Enter') send(); });
    </script>
</body>
</html>